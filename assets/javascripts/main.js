document.addEventListener('DOMContentLoaded', function() {
  //
  // read a file and load it in tty player
  //

  function read(fileObject, fileName) {
    var reader = new FileReader();

    reader.onerror = function() {
      alert('Error reading file: ' + fileName);
    };
    reader.onloadend = function(event) {
      var
        cols = parseInt(colsInput.value) || 80,
        rows = parseInt(rowsInput.value) || 25,
        array = new Uint8Array(event.target.result);

      ttyPlayer.destroy();
      ttyPlayer = new TTYPlay('ttyplay', {
        cols          : cols,
        rows          : rows,
        rawTtyRecord  : array,
        gzip          : /\.gz$/.test(fileName),
        auto          : true
      });
    }

    reader.readAsArrayBuffer(fileObject);
  }

  //
  // the world
  //

  var
    colsInput = document.getElementById('cols'),
    rowsInput = document.getElementById('rows'),
    openFileTrigger = document.getElementById('open-file-trigger'),
    openFileInput = document.getElementById('open-file'),
    dropContainer = document.getElementById('drop-container'),
    ttyPlayer = new TTYPlay('ttyplay', {
      cols  : 80,
      rows  : 25,
      url   : '/assets/data/hello.gz',
      gzip  : true,
      auto  : true
    });

  //
  // be nice
  //

  if (0) /* or not */ ttyPlayer.terminal.write('\x1b\x5b\x48\x1b\x5b\x32\x4a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x2e\x2e\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x2e\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x2e\x2e\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x61\x61\x64\x38\x38\x38\x38\x38\x38\x38\x38\x62\x61\x61\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x2e\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x2e\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x64\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x1b\x5b\x30\x3b\x30\x6d\x3f\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x3f\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x62\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x2e\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x64\x38\x38\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x1b\x5b\x30\x3b\x30\x6d\x3f\x38\x38\x38\x38\x38\x38\x38\x38\x38\x3f\x3f\x61\x38\x38\x38\x38\x38\x38\x62\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x2e\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x64\x38\x38\x38\x38\x38\x38\x38\x61\x38\x38\x38\x38\x38\x38\x38\x38\x61\x61\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x62\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x64\x50\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x59\x62\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x64\x50\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x59\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x50\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x59\x62\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x64\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x59\x38\x38\x38\x38\x38\x38\x38\x38\x50\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x62\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x2e\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x40\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x59\x38\x38\x38\x38\x38\x38\x50\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x40\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x59\x38\x62\x61\x61\x61\x61\x61\x61\x61\x61\x61\x61\x38\x38\x50\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x1b\x5b\x30\x3b\x30\x6d\x54\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x1b\x5b\x30\x3b\x30\x6d\x59\x38\x38\x61\x61\x61\x61\x61\x61\x61\x61\x61\x61\x61\x64\x38\x50\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x59\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x50\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x59\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x50\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x27\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x62\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x27\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x64\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x27\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x27\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x27\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x50\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x27\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x27\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x1b\x5b\x30\x3b\x30\x6d\x38\x38\x1b\x5b\x30\x3b\x33\x31\x6d\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x27\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x27\x27\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x27\x27\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x27\x27\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x3a\x27\x27\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x33\x31\x6d\x7c\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x1b\x5b\x30\x3b\x30\x6d\x7c\x1b\x5b\x30\x3b\x30\x6d\x0d\x0a\x1b\x5b\x30\x3b\x30\x6d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d\x2d\x1b\x5b\x30\x3b\x33\x31\x6d\x3d\x1b\x5b\x30\x3b\x30\x6d');

  //
  // lazily force only numeric input
  //

  colsInput.onkeydown =
  colsInput.onkeyup =
  rowsInput.onkeydown =
  rowsInput.onkeyup =
  function(event) {
    var key = event.keyCode || event.which;

    if ((key < 0x30 || key > 0x39) && key != 0x08 && key != 0x09) {
      return false;
    }
  };

  //
  // open file click handler
  //

  openFileTrigger.onclick = function() {
    var event = document.createEvent('MouseEvents');
    event.initEvent('click', true, false);
    openFileInput.dispatchEvent(event);
  };

  openFileInput.onchange = function() {
    var fileName = this.value, fileObject = this.files[0];

    if (fileName && fileObject) {
      read(fileObject, fileName);
    }
  };

  //
  // drag & drop support
  //

  dropContainer.ondragenter =
  dropContainer.ondragover =
  function(event) {
    event.dataTransfer.effectAllowed = 'copy';
    dropContainer.className = 'control drag-over';
    return false;
  };

  dropContainer.ondragleave =
  dropContainer.ondragend =
  function(event) {
    dropContainer.className = 'control';
    return false;
  };

  dropContainer.ondrop = function(event) {
    var fileObject = event.dataTransfer.files[0];

    if (fileObject) {
      read(fileObject, fileObject.name);
    }

    return false;
  };

  //
  // one final hack
  //

  if (0) /* guess we don't need this */ document.oncopy = function() {
    console.log('oncopy');

    try {
      var
        body = document.body,
        selection = window.getSelection(),
        firstRange = selection.getRangeAt(0),
        text = selection.toString().replace(/ +$/m, '').replace(/\xa0+$/m, '').split('\n').join('<br />'),
        element = document.createElement('p');

      element.style.position = 'absolute';
      element.style.left = '-31337px';
      element.style.top = '-31337px';
      element.innerHTML = text;

      body.appendChild(element);
      selection.selectAllChildren(element);

      setTimeout(function() {
        document.body.removeChild(element);

        selection.removeAllRanges();
        selection.addRange(firstRange);
      }, 0);
    } catch (e) {
      // cry, cry, little baby!
    }
  };
});
